<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Cine GO</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Custom CSS -->
	<link rel="stylesheet" href="css/main.css">
    <link href="css/custom.css" rel="stylesheet">
	
	<script src="//use.edgefonts.net/bebas-neue.js"></script>

	<link rel="stylesheet" href="css/icomoon-social.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	
	<script src="js/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	

</head>

    <body>

    <header class="navbar navbar-inverse navbar-fixed-top" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html"><img src="img/logo.png" alt="Basica"></a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/">Inicio</a></li>
                    <li class="active"><a href="#">Cartelera</a></li>
                    <li><a href="/log">Inicio Sesion</a></li>
                </ul>
            </div>
        </div>
    </header><!--/header-->


        <!-- Page Title -->
		<div class="section section-breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<h1>Cartelera </h1>
					</div>
				</div>
			</div>
		</div>
<hr>			
        
        <div class="section">
	        <div class="container">
	        	<div class="row" id="Contenedor_Cartelera">
	        		<!--<div class="col-md-4 col-sm-6">
	        			<div >
		        			<img src="/imagenes/Portada.jpg" class="img" style="width:200px; height:300px"/>
		        			<p><h3>Eterno Resplandor</h3></p>
		        			<p>Praesent rhoncus mauris ac sollicitudin vehicula. Nam fringilla turpis turpis, at posuere turpis aliquet sit amet condimentum</p>
                            <p>Clasificacion A</p>
		        			<a href="#" class="btn">17:45</a>
		        			<a href="#" class="btn">19:30</a>
		        		</div>
	        		</div>-->
	        	</div>
	        </div>
	    </div>


<hr>
	
        <!-- Javascripts -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/jquery-1.9.1.min.js"><\/script>')</script>
        <script src="js/bootstrap.min.js"></script>
    
		
		<!-- Scrolling Nav JavaScript -->
		<script src="js/jquery.easing.min.js"></script>
    <script src="js/js/js_Cart.js"></script>
		<script src="js/scrolling-nav.js"></script>	
        <script src="https://unpkg.com/adonis-websocket-client@1.0.2/dist/ws.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                /*var info = {
                    asientoActual:"",
                    asientoAnterior:"",
                    error:false,
                    usuario:{{currentUser.id}}
                };*/
                const io = ws('')
                const client = io.channel('Asientos').connect()
                client.joinRoom('SalaA', {}, function (error, joined) {
                    console.log(joined);
                    console.log(error);
                })
                client.on('message',function(a,b){
                    if(a.error == 'False'){
                        var atributo = $('#'+a.asientoActual).attr("class")
                        if(atributo == 'cuadrado-Seleccionado' && info.usuario != {{currentUser.id}}){
                            info.error = 'True'
                            client.emit("message",info)
                        }else{
                            $('#'+a.asientoActual).attr("class",'cuadrado-Seleccionado')
                            $('#'+a.asientoAnterior).attr("class",'cuadrado-Noseleccionado')
                        }
                    }else{
                        if(info.usuario = {{currentUser.id}}){
                            alert("Este asiento se encuentra ocupado")
                            $('#'+a.asientoAnterior).attr("class",'cuadrado-Seleccionado')
                            $('#'+a.asientoActual).attr("class",'cuadrado-Noseleccionado')
                        }
                    }
                })
            
                agregarAsientos();
                function agregarAsientos(){
                    for(var i = 1; i<=50; i++){
                        $('#content-2').append('<div class="col-sm-2"><div id="Asiento-'+i+'"  class="cuadrado-Noseleccionado">'+i+'</div></div>')
                        logicaWebsocket(i)
                    } 
                }
                function insertarAsiento(Asiento){
                    $.ajax({
                        type:'post',
                        url:'/Login/insertarAsiento',
                        data:{Asiento:Asiento,Venta:1}
                    }).done(function(response){
                        console.log(response)
                    });
                }
                function eliminarAsiento(Asiento){
                    $.ajax({
                        type:'post',
                        url:'/Login/eliminarAsiento',
                        data:{Asiento:Asiento,Venta:1}
                    }).done(function(response){
                        
                    });
                }
                function logicaWebsocket(i){
                    $('#div-Asientos div #Asiento-'+i).bind('click',function(){
                            if(clase != 'cuadrado-Ocupado'){
                                var Asiento = $(this).attr("id").split('-')                            
                                var clase = $(this).attr("class")
                        
                               if(clase == 'cuadrado-Noseleccionado'){
                                    info.asientoAnterior = info.asientoActual
                                    info.asientoActual = $(this).attr("id")
                                    info.error = 'False'
                                    insertarAsiento(Asiento[1])
                                    $('#'+info.asientoAnterior).attr("class","cuadrado-Noseleccionado")
                                    $('#'+info.asientoAnterior).attr("usuario","")
                                    $(this).attr("class","cuadrado-Seleccionado")
                                    $(this).attr("usuario",{{currentUser.id}})
                                    client.emit("message",info)
                                }else{
                                    var usuarioAsiento =  $(this).attr("usuario",{{currentUser.id}})
                                    if(usuarioAsiento != {{currentUser.id}}){
                                        alert("Se encuentra Ocupado este Asiento")
                                    }
                                }
                            }else{
                                alert("Se encuentra Ocupado este Asiento")
                            }  
                    })
                }
            });
        </script>
        <style>
        
            .div-imagen{
                height:350px;
                background:url("/img/asientos-cine.jpg") center no-repeat;
                background-size:cover;
                
            }
            .cuadrado-Noseleccionado{
                width: 75;
                height: 75;
                border: 3px solid #555;
                font-size: small;
                color:#000;
                background-color: floralwhite;
            }
            .cuadrado-Seleccionado{
                width: 75;
                height: 75;
                border: 3px solid #555;
                width: 75;
                height: 75;
                border: 3px solid #555;
                font-size: small;
                color:#000;
                background-color:forestgreen;
            }
            .cuadrado-Ocupado{
                width: 75;
                height: 75;
                border: 3px solid #555;
                width: 75;
                height: 75;
                border: 3px solid #555;
                font-size: small;
                color:darkred;
                background-color:forestgreen;
            }
            * {
                 font-family: Arial, sans;
                 margin: 0;
                 padding: 0;
                 box-sizing: border-box;
                 -moz-box-sizing: border-box;
                }
                h1 {
                 margin: 1em 0;
                 text-align: center;
                }
                #container {
                 margin: 0 auto;
                 width: 50%; /* Ancho del contenedor */
                }
                #container input {
                 height: 2.5em;
                 visibility: hidden;
                }
                #container label {
                 background: #f9f9f9; /* Fondo de las pesta単as */
                 border-radius: .25em .25em 0 0;
                 color: #888; /* Color del texto de las pesta単as */
                 cursor: pointer;
                 display: block;
                 float: left;
                 font-size: 1em; /* Tama単o del texto de las pesta単as */
                 height: 2.5em;
                 line-height: 2.5em;
                 margin-right: .25em;
                 padding: 0 1.5em;
                 text-align: center;
                }
                #container input:hover + label {
                 background: #ddd; /* Fondo de las pesta単as al pasar el cursor por encima */
                 color: #666; /* Color del texto de las pesta単as al pasar el cursor por encima */
                }
                #container input:checked + label {
                 background: #f1f1f1; /* Fondo de las pesta単as al presionar */
                 color: #444; /* Color de las pesta単as al presionar */
                 position: relative;
                 z-index: 6;
                }
                #content {
                 background: #f1f1f1; /* Fondo del contenido */
                 border-radius: 0 .25em .25em .25em;
                 min-height: 20em; /* Alto del contenido */
                 position: relative;
                 width: 100%;
                 z-index: 5;
                }
                #content #content-1,
                #content #content-2,
                #content #content-3{
                    opacity: 0;
                    padding: 1.5em;
                    z-index: -100
                    position: absolute
                }
                #content-2 {
                    height:350px;
                    background:url("/img/asientos-cine.jpg") center no-repeat;
                    background-size:cover;
                }
                #container input#tab-1:checked ~ #content #content-1 ,
                #container input#tab-2:checked ~ #content #content-2 ,
                #container input#tab-3:checked ~ #content #content-3 {
                 opacity: 1;
                 z-index: 100;
                }    
        </style>
    </body>
    </html>