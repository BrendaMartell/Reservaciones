<!DOCTYPE html>
<html class="no-js"> <!--<![endif]-->
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Cine GO</title>

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.css" rel="stylesheet">

    <!-- Custom CSS -->
	<link rel="stylesheet" href="/css/main.css">
    <link href="/css/custom.css" rel="stylesheet">
	
	<script src="//use.edgefonts.net/bebas-neue.js"></script>

    <!-- Custom Fonts & Icons -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,600,800' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/icomoon-social.css">
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	
	<script src="/js/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	

</head>

    <body>  
    <header class="navbar navbar-inverse navbar-fixed-top" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Cine GO</a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/">Inicio</a></li>
                    <li><a href="/nosotros">Sobre Nosotros</a></li>
                    <li><a href="/cartelera">Cartelera</a></li>
                    <li><a href="/galeria">Galeria</a></li>
                    <li><a href="/log">Inicio Sesion</a></li>
                </ul>
            </div>
        </div>
    </header><!--/header-->
        <hr>   
        <hr>   
        <hr>   
        
        
        <div class="section">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-2">
                    <img id="Imagen" style="height:200px; width:200px;">
                </div>
                <div class="col-md-6">
                    <div class="row" id="Clasificacion"></div>
                    <div class="row" id="Fecha_Hora"></div>
                    <div class="row" id="Sinopsis"></div>
                    <div class="row" id="Video"></div>
                </div>
            </div>
        </div>
        
        
        <hr>   
        <hr>   
        
        <div class="section">
	    	<div class="container">
                 <div id="container">
                  <!--Pestaña 1 activa por defecto-->
                  <input id="tab-1" type="radio" name="tab-group" checked="checked" />
                  <label for="tab-1">Pestaña 1</label>
                  <!--Pestaña 2 inactiva por defecto-->
                  <input id="tab-2" type="radio" name="tab-group" />
                  <label for="tab-2">Pestaña 2</label>
                  <!--Pestaña 3 inactiva por defecto-->
                  <input id="tab-3" type="radio" name="tab-group" />
                  <label for="tab-3">Pestaña 3</label>
                  <!--Contenido a mostrar/ocultar-->
                  <div id="content">
                   <!--Contenido de la Pestaña 1-->
                   <div id="content-1">
                       <center>Boleto de Adulto</center>
                       <br/>
                        <br/>
                       <div>
                            <div class="col-md-1"></div>
                            <div class="col-md-3"><button id="Adulto_menos" >-</button></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-3"><label id="lb-Adulto" >0</label></div>
                            <div class="col-md-2"></div>
                            <div class="col-md-2"><button id="Adulto_mas" >+</button></div>
                       </div>
                        <br/> 
                       <br/>
                        <br/>
                       <center>Boleto de Adolescente</center>
                       <br/>
                        <br/>
                       <div>
                            <div class="col-md-1"></div>
                            <div class="col-md-3"><button id="Adolescente_menos" >-</button></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-3"><label id="lb-Adolescente">0</label></div>
                            <div class="col-md-2"></div>
                            <div class="col-md-2"><button id="Adolescente_mas" >+</button></div>
                       </div>
                        <br/> 
                       <br/>
                        <br/>
                       <center>Boleto de Viejito</center>
                       <br/>
                        <br/>
                       <div>
                            <div class="col-md-1"></div>
                            <div class="col-md-3"><button id="Viejito_menos" >-</button></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-3"><label id="lb-Viejito">0</label></div>
                            <div class="col-md-2"></div>
                            <div class="col-md-2"><button id="Viejito_mas">+</button></div>
                       </div>
                       <button id="seleccionarASientos">Seleccionar ASientos</button>
                   </div>
                   <!--Contenido de la Pestaña 2-->
                   <div id="content-2">
                       <br/>
                       <br/>
                       <div id="cantidadBoletos"></div>
                       <br/>
                       <br/>
                       <div id="asientos"></div>
                       <div class="col-sm-2"><button id="btnGuardar">Guardar</button></div>
                   </div>
                   <!--Contenido de la Pestaña 3-->
                   <div id="content-3">

                   </div>
                  </div>
                 </div>
	    	</div>
	    </div>


<hr>
		
	    <!-- Footer -->
	    <div class="footer">
	    	<div class="container">
			
		    	<div class="row">
				
		    		<div class="col-footer col-md-4 col-xs-6">
		    			<h3>Contact Us</h3>
		    			<p class="contact-us-details">
	        				<b>Address:</b> 123 Downtown Avenue, Manhattan, New York, United States of America<br/>
	        				<b>Phone:</b> +1 123 45678910<br/>
	        				<b>Fax:</b> +1 123 45678910<br/>
	        				<b>Email:</b> <a href="mailto:info@yourcompanydomain.com">info@yourcompanydomain.com</a>
	        			</p>
		    		</div>				
		    		<div class="col-footer col-md-4 col-xs-6">
		    			<h3>Our Social Networks</h3>
						<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam.</p>
		    			<div>
		    				<img src="/img/icons/facebook.png" width="32" alt="Facebook">
		    				<img src="/img/icons/twitter.png" width="32" alt="Twitter">
		    				<img src="/img/icons/linkedin.png" width="32" alt="LinkedIn">
							<img src="/img/icons/rss.png" width="32" alt="RSS Feed">
						</div>
		    		</div>
		    		<div class="col-footer col-md-4 col-xs-6">
		    			<h3>About Our Company</h3>
		    				<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci.</p>
		    		</div>

		    	</div>
		    	<div class="row">
		    		<div class="col-md-12">
		    			<div class="footer-copyright">&copy; 2014 <a href="http://www.vactualart.com/portfolio-item/basica-a-free-html5-template/">Basica</a> Bootstrap HTML Template. By <a href="http://www.vactualart.com">Vactual Art</a>.</div>
		    		</div>
		    	</div>
		    </div>
	    </div>

        <!-- Javascripts -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/jquery-1.9.1.min.js"><\/script>')</script>
        <script src="/js/bootstrap.min.js"></script>
		
		<!-- Scrolling Nav JavaScript -->
		<script src="/js/jquery.easing.min.js"></script>
		<script src="/js/scrolling-nav.js"></script>	
        <script src="https://unpkg.com/adonis-websocket-client@1.0.2/dist/ws.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
<<<<<<< HEAD
                var funcion = '{{funciones[0].id}}'
                $('#Imagen').attr('src','/imagenes/{{funciones[0].imagen}}')
                $('#Clasificacion').html('Clasificacion: ' + ' {{funciones[0].clasificacion}}')
                $('#Hora').html('Hora: ' + ' {{funciones[0].Hora}}')
                $('#Sinopsis').html('Sinopsos: ' + ' {{funciones[0].sinopsis}}')
=======
<<<<<<< HEAD
                console.log('{{funciones[0].id}}')
                $('#Imagen').attr('src',"/imagenes/" + '{{funciones[0].imagen}}')
                $('#Clasificacion').html('<div class="col-md-12"><p><b>Clasificacion:</b> ' +  '{{funciones[0].clasificacion}}'+"</p></div>");
                
                $('#Video').html('<div class="col-md-12"><p><b><a href="'+ '{{funciones[0].video}}'+'"  target="_blank" >Ver Trailer</a></b></p></div>');
                $('#Fecha_Hora').html('<div class="col-md-12"><p><b>Fecha y Hora:</b> '+'{{funciones[0].fecha}}' + " - " + '{{funciones[0].hora}}'+"</p></div>");
                $('#Sinopsis').html('<div class="col-md-12"><p><b>Sinopsis: </b>'+ '{{funciones[0].sinopsis}}'+"</p></div>");
=======
                console.log('{{funciones[0].id}}') 
                $('#Imagen').attr('src','{{funciones[0].imagen}}')
                $('#Clasificacion').html('Clasificacion: ' + ' {{funciones[0].clasificacion}}')
                //$('#Fecha/Hora').html(funcion.fecha + funcion.hora)
                //$('#Sinopsis').html(funcion.sinopsis)
>>>>>>> 5b271fbac863f1c971b5e9fa1fc6c41b177799ca
>>>>>>> 7109d912c7d01c953ffca9b9443d652ac0a718fd
                
                var cantBoletos=0
                var info = {}
                var Asientos = []                          
                var AsientoSel = {
                    asientoActual:"",
                    asientoAnterior:"",
                    Asiento:0
                }
                const io = ws('')
                //const ventas = io.channel('Ventas').connect()
                const client = io.channel('Asientos').connect()
                client.on('message',function(a,b){
                    console.log(a)
                    if(a.error == 'False'){
                        var atributo = $('#'+a.asientoActual).attr("class")
                        if(atributo == 'cuadrado-Seleccionado' && info.usuario != {{currentUser.id}}){
                            info.error = 'True'
                            client.emit("message",info)
                        }else{
                            $('#'+a.asientoActual).attr("class",'cuadrado-Seleccionado')
                            $('#'+a.asientoAnterior).attr("class",'cuadrado-Noseleccionado')
                        }
                    }else{
                        if(a.usuario = {{currentUser.id}}){
                            alert("Este asiento se encuentra ocupado")
                            $('#'+a.asientoAnterior).attr("class",'cuadrado-Seleccionado')
                            $('#'+a.asientoActual).attr("class",'cuadrado-Noseleccionado')
                        }
                    }
                })
                
                                
                agregarAsientos();
                function agregarAsientos(){
                    $('#content-2 #asientos').children().remove()
                    for(var i = 1; i<=50; i++){
                        $('#content-2 #asientos').append('<div class="col-sm-2"><div id="Asiento-'+i+'"  class="cuadrado-Noseleccionado">'+i+'</div>')
                        logicaWebsocket(i)
                    } 
                }
                function logicaWebsocket(i){
                    $('#content-2 #asientos #Asiento-'+i).bind('click',function(){
                            if(AsientoSel.Asiento > -1){
                                if(clase != 'cuadrado-Ocupado'){
                                    var Asiento = $(this).attr("id").split('-')                            
                                    var clase = $(this).attr("class")

                                   if(clase == 'cuadrado-Noseleccionado'){
                                        Asientos[AsientoSel.Asiento].error = 'False'
                                        Asientos[AsientoSel.Asiento].asientoAnterior = Asientos[AsientoSel.Asiento].asientoActual
                                        Asientos[AsientoSel.Asiento].asientoActual = $(this).attr('id')
                                        
                                        $('#'+Asientos[AsientoSel.Asiento].asientoAnterior).attr("class","cuadrado-Noseleccionado")
                                        $('#'+Asientos[AsientoSel.Asiento].asientoAnterior).removeAttr("usuario") 
                                        $('#'+Asientos[AsientoSel.Asiento].asientoActual).attr("class","cuadrado-Seleccionado")
                                        $('#'+Asientos[AsientoSel.Asiento].asientoActual).attr("usuario",{{currentUser.id}})
                                       console.log(AsientoSel.Asiento)
                                       console.log(Asientos[AsientoSel.Asiento])
                                       console.log(Asientos)
                                        client.emit("message",funcion + '/' +Asientos[AsientoSel.Asiento])
                                    }else{
                                        var usuarioAsiento =  $(this).attr("usuario",{{currentUser.id}})
                                        if(usuarioAsiento != {{currentUser.id}}){
                                            alert("Se encuentra Ocupado este Asiento")
                                        }
                                    }
                                }else{
                                    alert("Se encuentra Ocupado este Asiento")
                                } 
                            }else{
                                alert('Seleccione un asiento')
                            }
                    })
                }
            
                cargarAsientos()
                function cargarAsientos(){
                    $.ajax({
                        type:'Post',
                        url:'/Login/Boletos/'+funcion
                    }).done(function(response){
                        $.each(response,function(a,b){
                            $('#Asiento-'+b.localidad).attr("class","cuadrado-Ocupado")
                        })
                    })
                }
                
                $('#btnGuardar').click(function(){
                    $.ajax({
                        type:'Post',
                        url:'/Login/Venta',
                        data:{asientos:Asientos,funcion:'{{funciones[0].id}}'}
                    }).done(function(response){
                        //ventas.emite('message','Venta')
                    })
                })
                
            
                seleccionBoletos('Adulto_menos')
                seleccionBoletos('Adulto_mas')
                seleccionBoletos('Adolescente_menos')
                seleccionBoletos('Adolescente_mas')
                seleccionBoletos('Viejito_menos')
                seleccionBoletos('Viejito_mas')
            
                function seleccionBoletos(selector){
                    $('#'+selector).click(function(){
                        var valores = $(this).attr('id').split('_')
                        console.log(valores)
                        var boletos = $('#lb-'+valores[0]).html()
                        console.log(boletos)
                        if(valores[1] == 'mas'){
                            boletos =  parseFloat(boletos) + 1
                            cantBoletos = parseFloat(boletos) + 1
                            $('#lb-'+valores[0]).html(boletos)
                        }else{
                            if(boletos > 0){
                                boletos = boletos - 1
                                cantBoletos = cantBoletos - 1
                                $('#lb-'+valores[0]).html(boletos)
                            }
                        }
                    })
                } 
                function agregarCantidadAsientos(){
                    $('#cantidadBoletos').children().remove()
                    Asientos = []
                    for(var i = 1; i<cantBoletos; i++){
                        info = {
                    asientoActual:"",
                    asientoAnterior:"",
                    error:false,
                    usuario:{{currentUser.id}}
                }
                        $('#cantidadBoletos').append('<div class="col-sm-2"><div id="numAsiento-'+i+'"  class="cuadrado-Noseleccionado">'+i+'</div></div>')
                        Asientos.push(info)
                        logicaCantAsientos(i)
                    } 
                }
                function logicaCantAsientos(i){
                    $('#content-2 #cantidadBoletos #numAsiento-'+i).bind('click',function(){
                        AsientoSel.asientoAnterior = AsientoSel.asientoActual
                        AsientoSel.asientoActual = $(this).attr('id')
                        $('#'+AsientoSel.asientoAnterior).attr('class','cuadrado-Noseleccionado')
                        $('#'+AsientoSel.asientoActual).attr('class','cuadrado-Seleccionado')
                        AsientoSel.Asiento = i-1
                    })
                }
            
                $('#seleccionarASientos').click(function(){
                    if(cantBoletos > 0){
                        agregarCantidadAsientos()
                        $('#tab-1').removeAttr('checked')
                        $('#tab-2').attr('checked','checked')
                    }
                })
            
                $('#tab-1').on('change',function(){
                    agregarAsientos()
                    client.leaveRoom('Sala'+funcion, {}, function (error, left) {
                        console.log('Salida de sala' +left)
                    })
                })
                $('#tab-2').on('change',function(){
                    client.joinRoom('Sala'+funcion, {}, function (error, joined) {
                        console.log('Entrada a Sala' + joined)
                    })
                })
            });
        </script>
        <style>
        
            .div-imagen{
                height:350px;
                background:url("/img/asientos-cine.jpg") center no-repeat;
                background-size:cover;
                
            }
            .cuadrado-Noseleccionado{
                width: 75;
                height: 75;
                border: 3px solid #555;
                font-size: small;
                color:#000;
                background-color: floralwhite;
            }
            .cuadrado-Seleccionado{
                width: 75;
                height: 75;
                border: 3px solid #555;
                font-size: small;
                color:#000;
                background-color:forestgreen;
            }
            .cuadrado-Ocupado{
                width: 75;
                height: 75;
                border: 3px solid #555;
                font-size: small;
                color:aliceblue;
                background-color:firebrick;
            }
            * {
                 font-family: Arial, sans;
                 margin: 0;
                 padding: 0;
                 box-sizing: border-box;
                 -moz-box-sizing: border-box;
                }
                h1 {
                 margin: 1em 0;
                 text-align: center;
                }
                #container {
                 margin: 0 auto;
                 width: 50%; /* Ancho del contenedor */
                }
                #container input {
                 height: 2.5em;
                 visibility: hidden;
                }
                #container label {
                 background: #f9f9f9; /* Fondo de las pestañas */
                 border-radius: .25em .25em 0 0;
                 color: #888; /* Color del texto de las pestañas */
                 cursor: pointer;
                 display: block;
                 float: left;
                 font-size: 1em; /* Tamaño del texto de las pestañas */
                 height: 2.5em;
                 line-height: 2.5em;
                 margin-right: .25em;
                 padding: 0 1.5em;
                 text-align: center;
                }
                #container input:hover + label {
                 background: #ddd; /* Fondo de las pestañas al pasar el cursor por encima */
                 color: #666; /* Color del texto de las pestañas al pasar el cursor por encima */
                }
                #container input:checked + label {
                 background: #f1f1f1; /* Fondo de las pestañas al presionar */
                 color: #444; /* Color de las pestañas al presionar */
                 position: relative;
                 z-index: 6;
                }
                #content {
                 background: #f1f1f1; /* Fondo del contenido */
                 border-radius: 0 .25em .25em .25em;
                 position: relative;
                 width: 100%;
                 height: 400px;
                 z-index: 5;
                }
                #content #content-1,
                #content #content-2,
                #content #content-3{
                    display: none;
                    opacity: 0;
                    padding: 1.5em;
                    z-index: -100;
                    position: relative;
                }
                #content-2 {
                    height:350px;
                    background:url("/img/asientos-cine.jpg") center no-repeat;
                    background-size:cover;
                }
                #container input#tab-1:checked ~ #content #content-1 ,
                #container input#tab-2:checked ~ #content #content-2 ,
                #container input#tab-3:checked ~ #content #content-3 {
                 display:  block;
                 opacity: 1;
                 z-index: 100;
                } 
        </style>
    </body>
    </html>